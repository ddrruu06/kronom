<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maraton Pomodoro TV</title>
    
    <!-- React ve ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* TV İÇİN SIFIRLAMA VE TEMEL AYARLAR */
        html, body {
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            color: white;
            font-family: system-ui, -apple-system, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 53:30 ORAN KORUYUCU KONTEYNER */
        #tv-container {
            position: relative;
            width: 100%;
            height: 100%;
            /* Eni boyuna göre ayarla (53/30 = ~1.766) */
            max-width: calc(100vh * (53 / 30)); 
            /* Boyu enine göre ayarla */
            max-height: calc(100vw * (30 / 53)); 
            aspect-ratio: 53 / 30;
            background-color: #111;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid #333; 
        }

        /* SVG Ayarları */
        svg { 
            display: inline-block; 
            vertical-align: middle; 
            will-change: transform; 
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 1s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            will-change: stroke-dashoffset;
        }

        /* Başarı Efekti */
        @keyframes success-pulse {
            0% { background-color: rgba(34, 197, 94, 0); }
            50% { background-color: rgba(34, 197, 94, 0.6); }
            100% { background-color: rgba(34, 197, 94, 0); }
        }
        .success-overlay {
            position: absolute; inset: 0;
            pointer-events: none; z-index: 9999;
            animation: success-pulse 1s ease-out forwards;
        }
        
        /* Mola Arka Planı */
        .bg-break { background-color: #7f1d1d; }
    </style>
</head>
<body>

    <div id="root" style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- GÖRSELLER ---
        const bgImages = [
            'gorsela.jpg',
            'gorselb.jpg',
            'gorselc.jpg',
            'gorseld.jpg',
            'gorsele.jpg',
            'gorself.jpg'
        ];

        // --- SVG İKONLAR ---
        const Icons = {
            Play: ({ s=24, className="" }) => <svg className={className} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: ({ s=24 }) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            Square: ({ s=24 }) => <svg width={s} height={s} viewBox="0 0 24 24" fill="currentColor" stroke="none"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>,
            Refresh: ({ s=24 }) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 2v6h6"/><path d="M21 12A9 9 0 0 0 6 5.3L3 8"/><path d="M21 22v-6h-6"/><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"/></svg>,
            Trophy: ({ s=24 }) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            Image: ({ s=24 }) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        };

        // --- SES MOTORU ---
        const playSuccessSound = () => {
            try {
                const AC = window.AudioContext || window.webkitAudioContext;
                if (!AC) return;
                const ctx = new AC();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1046, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start();
                osc.stop(ctx.currentTime + 0.6);
            } catch (e) {}
        };

        // --- AKTİF ÇEMBER ---
        const ActiveProgressRing = React.memo(({ progress }) => {
            const radius = 46; 
            const circumference = 2 * Math.PI * radius;
            const p = isNaN(progress) ? 0 : progress;
            const offset = circumference - (p * circumference);
            
            return (
                <div className="absolute inset-0 w-full h-full pointer-events-none" style={{ transform: 'scale(1.15)' }}>
                    <svg className="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                         <circle stroke="#333" strokeWidth="6" fill="transparent" r={radius} cx="50" cy="50"/>
                         <circle className="progress-ring-circle" stroke="#FACC15" strokeWidth="6" fill="transparent" r={radius} cx="50" cy="50"
                             style={{ strokeDasharray: `${circumference} ${circumference}`, strokeDashoffset: offset, strokeLinecap: "round" }}
                         />
                    </svg>
                </div>
            );
        });

        function App() {
            // State
            const [isRunning, setIsRunning] = useState(false);
            const [mode, setMode] = useState('WORK');
            const [workSec, setWorkSec] = useState(0);
            const [breakSec, setBreakSec] = useState(0);
            const [sessionSec, setSessionSec] = useState(0);
            const [flash, setFlash] = useState(false);
            
            // Görünüm Ayarları
            const [bgIndex, setBgIndex] = useState(0);
            const [brightness, setBrightness] = useState(50);

            // Sabitler
            const DURATION = 11 * 60; // 660 sn
            const CYCLES = [6, 5, 4, 3, 2, 1, 6, 5, 4, 3, 2, 1];
            const TARGET = 42;
            const BAR_MAX = 8 * 3600; // 8 Saat

            // Timer
            useEffect(() => {
                let interval = null;
                if (isRunning) {
                    interval = setInterval(() => {
                        setSessionSec(s => s + 1);
                        if (mode === 'WORK') setWorkSec(s => s + 1);
                        else setBreakSec(s => s + 1);
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [isRunning, mode]);

            // Hedef Kontrol (11dk)
            useEffect(() => {
                if (workSec > 0 && workSec % DURATION === 0) {
                    setFlash(true);
                    playSuccessSound();
                    setTimeout(() => setFlash(false), 1000);
                }
            }, [workSec]);

            // 42 Tamamlandıysa Durdur
            useEffect(() => {
                const sets = Math.floor(workSec / DURATION);
                if (sets > TARGET && isRunning && mode === 'WORK') {
                    reset();
                }
            }, [workSec]);

            // Fonksiyonlar
            const format = (s) => {
                const h = Math.floor(s / 3600);
                const m = Math.floor((s % 3600) / 60);
                const sec = s % 60;
                const p = (n) => n.toString().padStart(2, '0');
                return h > 0 ? `${h}:${p(m)}:${p(sec)}` : `${p(m)}:${p(sec)}`;
            };

            const toggleRun = () => setIsRunning(!isRunning);
            const toggleMode = () => {
                const m = mode === 'WORK' ? 'BREAK' : 'WORK';
                setMode(m);
                setSessionSec(0);
                setIsRunning(m === 'BREAK');
            };
            const reset = () => { setIsRunning(false); setMode('WORK'); setWorkSec(0); setBreakSec(0); setSessionSec(0); };
            const skip = () => setWorkSec(s => s + (DURATION - (s % DURATION)) + 1);

            // Piramit Hesabı
            const cycleData = useMemo(() => {
                let done = Math.floor(workSec / DURATION);
                if (done >= TARGET) return { current: null, phase: 3, locked: [1,2,3,4,5,6] };
                
                let locked = [], processed = 0, phase = 1, current = 0;
                for (let i = 0; i < CYCLES.length; i++) {
                    let end = processed + CYCLES[i];
                    if (done < end) {
                        phase = i < 6 ? 1 : 2;
                        current = (done - processed) + 1;
                        return { current, phase, locked };
                    }
                    if (i === 5) locked = []; else locked.push(CYCLES[i]);
                    processed += CYCLES[i];
                }
                return { current: 0, phase: 2, locked: [] };
            }, [workSec]);

            const progress = (workSec % DURATION) / DURATION;
            const barPct = Math.min((workSec / BAR_MAX) * 100, 100);

            // Stil Helper
            const getBubbleClass = (num, row) => {
                const { current, phase, locked } = cycleData;
                const active = phase === row && num === current;
                const reached = Math.floor(workSec / DURATION) >= TARGET;
                
                let cls = "relative w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center rounded-full text-3xl font-bold transition-all duration-300 border-[4px] ";
                
                if (reached) return cls + "border-green-500 text-green-500 bg-black/60";
                if (phase > row) return cls + "border-green-500 text-green-500 bg-black/60 opacity-60";
                
                if (phase === row) {
                    if (locked.includes(num)) return cls + "border-green-500 text-green-500 bg-black/60";
                    if (active) return cls + "border-transparent text-yellow-400 bg-black/80 scale-110 z-10"; 
                }
                
                return cls + "border-gray-600 text-gray-500 bg-black/40";
            };

            return (
                <div id="tv-container">
                    {flash && <div className="success-overlay"></div>}

                    {/* Arka Plan Katmanı */}
                    {mode === 'WORK' ? (
                        <>
                            <div className="absolute inset-0 bg-cover bg-center transition-opacity duration-500" 
                                 style={{ backgroundImage: `url('${bgImages[bgIndex]}')` }}></div>
                            <div className="absolute inset-0 bg-black transition-opacity duration-300" 
                                 style={{ opacity: 1 - (brightness / 100) }}></div>
                        </>
                    ) : (
                        <div className="absolute inset-0 bg-break"></div>
                    )}

                    {/* --- ÜST KISIM: KONTROLLER VE BALONCUKLAR --- */}
                    <div className="flex-1 w-full flex flex-col p-6 relative z-10">
                        
                        {/* Sol Üst Mini Kontrol */}
                        <div className="absolute top-6 left-6 flex gap-2 opacity-50 hover:opacity-100 transition-opacity">
                            <button onClick={() => setBrightness(b => Math.max(0, b-10))} className="w-12 h-12 bg-black/50 text-white rounded text-2xl">-</button>
                            <button onClick={() => setBgIndex(i => (i+1)%bgImages.length)} className="w-12 h-12 bg-black/50 text-white rounded flex items-center justify-center"><Icons.Image/></button>
                            <button onClick={() => setBrightness(b => Math.min(100, b+10))} className="w-12 h-12 bg-black/50 text-white rounded text-2xl">+</button>
                        </div>

                        {/* Baloncuklar (Piramit) */}
                        <div className="flex flex-col items-center justify-center gap-6 mt-4 w-full max-w-3xl mx-auto">
                            {[1, 2].map(row => (
                                <div key={row} className="flex justify-between w-full">
                                    {[1, 2, 3, 4, 5, 6].map(num => (
                                        <div key={num} className={getBubbleClass(num, row)}>
                                            {/* Aktif Ring */}
                                            {cycleData.phase === row && num === cycleData.current && <ActiveProgressRing progress={progress} />}
                                            <span className="relative z-10">{num}</span>
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* --- ORTA KISIM: SAYAÇ --- */}
                    <div className="flex-[2] flex flex-col items-center justify-center relative z-10 -mt-8">
                        <div className={`text-xl font-bold tracking-[0.3em] mb-2 ${mode==='WORK' ? 'text-yellow-400' : 'text-white'}`}>
                            {mode === 'WORK' ? 'ÇALIŞMA MODU' : 'MOLA MODU'}
                        </div>
                        
                        {/* Dev Sayaç (53:30'a uygun optimize edilmiş boyut) */}
                        <div className="font-bold leading-none tabular-nums" 
                             style={{ fontSize: '22vh', textShadow: '0 4px 10px rgba(0,0,0,0.5)' }}>
                            {format(sessionSec)}
                        </div>

                        {/* Hedef Bilgisi */}
                        <div className="mt-4 flex items-center gap-3 text-2xl font-medium text-gray-200 bg-black/40 px-6 py-2 rounded-full">
                            <span>Anlık Hedef:</span>
                            <span className="text-white font-bold">{Math.min(TARGET, Math.floor(workSec/DURATION)+1)}</span>
                            <span className="text-gray-400">/</span>
                            <span>{TARGET}</span>
                        </div>
                    </div>

                    {/* --- ALT KISIM: BUTONLAR VE İSTATİSTİKLER --- */}
                    <div className="flex-1 w-full flex flex-col justify-end relative z-10 pb-16">
                        
                        {/* Butonlar */}
                        <div className="flex justify-center gap-10 mb-8">
                            <button onClick={toggleRun} className={`w-24 h-24 rounded-full flex items-center justify-center border-[4px] transition-transform active:scale-95 bg-black/40 ${isRunning ? 'border-yellow-400 text-yellow-400' : 'border-green-500 text-green-500'}`}>
                                {isRunning ? <Icons.Pause s={40}/> : <Icons.Play s={40} className="ml-1"/>}
                            </button>
                            
                            {(isRunning || sessionSec > 0) && (
                                <button onClick={toggleMode} className={`w-24 h-24 rounded-full flex items-center justify-center border-[4px] active:scale-95 transition-transform bg-black/40 ${mode === 'WORK' ? 'border-red-600 text-red-600 hover:bg-red-600/10' : 'border-green-500 text-green-500 hover:bg-green-500/10'}`}>
                                    {mode === 'WORK' ? <Icons.Square s={30}/> : <Icons.Play s={40} className="ml-1"/>}
                                </button>
                            )}
                        </div>

                        {/* İstatistikler */}
                        <div className="flex justify-center gap-16 text-center">
                            <div className="bg-black/60 px-8 py-3 rounded-xl min-w-[300px]">
                                <div className="text-sm text-gray-400 uppercase font-bold mb-1 tracking-wider">Toplam Çalışma</div>
                                <div className="flex items-center justify-center gap-4 text-4xl font-mono font-bold">
                                    <button onClick={()=>setWorkSec(Math.max(0, workSec-660))} className="text-gray-500 hover:text-white transition-colors">-</button>
                                    <span className="w-40 tabular-nums">{format(workSec)}</span>
                                    <button onClick={()=>setWorkSec(workSec+660)} className="text-gray-500 hover:text-white transition-colors">+</button>
                                </div>
                            </div>
                            <div className="bg-black/60 px-8 py-3 rounded-xl min-w-[300px]">
                                <div className="text-sm text-gray-400 uppercase font-bold mb-1 tracking-wider">Toplam Mola</div>
                                <div className="flex items-center justify-center gap-4 text-4xl font-mono font-bold">
                                    <button onClick={()=>setBreakSec(Math.max(0, breakSec-660))} className="text-gray-500 hover:text-white transition-colors">-</button>
                                    <span className="w-40 tabular-nums">{format(breakSec)}</span>
                                    <button onClick={()=>setBreakSec(breakSec+660)} className="text-gray-500 hover:text-white transition-colors">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Gizli Debug */}
                    <div className="absolute bottom-20 right-4 opacity-0 hover:opacity-100 flex gap-2 z-50">
                        <button onClick={skip} className="bg-gray-800 p-2 text-xs rounded">Skip</button>
                        <button onClick={reset} className="bg-red-900 p-2 text-xs rounded"><Icons.Refresh/></button>
                    </div>

                    {/* Alt İlerleme Çubuğu */}
                    <div className="absolute bottom-0 left-0 w-full h-8 bg-gray-900 flex border-t border-black z-20">
                        {[...Array(8)].map((_, i) => (
                            <div key={i} className="flex-1 border-r border-black relative overflow-hidden bg-gray-800/50">
                                <div className="absolute top-0 left-0 h-full bg-green-600 transition-all duration-1000 ease-linear" 
                                     style={{ width: `${Math.max(0, Math.min(100, (barPct - (i * 12.5)) * 8))}%` }}>
                                </div>
                            </div>
                        ))}
                    </div>

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


